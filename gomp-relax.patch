--- gcc-7.1.0/libgomp/config/linux/wait.h~	2017-01-01 12:07:43.000000000 +0000
+++ gcc-7.1.0/libgomp/config/linux/wait.h	2017-07-29 03:50:12.998652035 +0000
@@ -48,6 +48,7 @@
 static inline int do_spin (int *addr, int val)
 {
   unsigned long long i, count = gomp_spin_count_var;
+  int j, mask = 1;
 
   if (__builtin_expect (__atomic_load_n (&gomp_managed_threads,
                                          MEMMODEL_RELAXED)
@@ -56,8 +57,12 @@
   for (i = 0; i < count; i++)
     if (__builtin_expect (__atomic_load_n (addr, MEMMODEL_RELAXED) != val, 0))
       return 0;
-    else
-      cpu_relax ();
+    else {
+      for (j = mask; j; j--)
+	      cpu_relax ();
+      if (mask < 32)
+	mask = mask * 2;
+    }
   return 1;
 }
 
